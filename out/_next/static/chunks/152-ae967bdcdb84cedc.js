(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[152],{2455:e=>{e.exports={"calendar-container":"CalendarStudent_calendar-container__v3KIZ","calendar-title":"CalendarStudent_calendar-title__FwfBy","instructions-box":"CalendarStudent_instructions-box__IzUO5","calendar-wrapper":"CalendarStudent_calendar-wrapper__WLUnp","current-events-section":"CalendarStudent_current-events-section__zFvVF","events-list":"CalendarStudent_events-list__0FUy2","event-badge":"CalendarStudent_event-badge__WsgQc","event-button":"CalendarStudent_event-button__Yp_0E","event-meeting":"CalendarStudent_event-meeting__HkprP","event-review":"CalendarStudent_event-review__dSyEj","event-social":"CalendarStudent_event-social__6P4iC","event-default":"CalendarStudent_event-default__khrsz"}},4152:(e,n,t)=>{"use strict";t.r(n),t.d(n,{StudentHome:()=>b,default:()=>j});var s=t(7876),r=t(4232),a=t(9999),i=t(2538),o=t(523),l=t(841),d=t.n(l);t(2287);var c=t(2455),u=t.n(c);let g=(0,o.ye)(d()),h=e=>{var n;let{onLessonClick:t}=e,[l,c]=(0,r.useState)([]),[h,x]=(0,r.useState)(!0),[p,m]=(0,r.useState)(null),{user:f,userType:b,userProfile:j,studentProfile:y}=(0,a.ur)(),v=(0,i.j)(),k=(null==v?void 0:v.studentId)||"",S=e=>{let{date:n}=e,t=new Date(n.year,n.month-1,n.day,n.hour,n.minute),s=e.durationMinutes||60,r=new Date(t.getTime()+60*s*1e3),a=e.confirmed?"scheduled":"pending";return{id:e.bookingId,title:"".concat(e.subject).concat(e.confirmed?"":" (Pending)"),start:t,end:r,status:a,booking:e}};(0,r.useEffect)(()=>{(async()=>{if(!k)return x(!1);try{x(!0),m(null);let e=(await v.fetchStudentBookings(k)).map(S);c(e)}catch(e){console.error("Error fetching bookings:",e),m("Failed to load bookings")}finally{x(!1)}})()},[k]);let _=async()=>{if(k)try{let e=(await v.fetchStudentBookings(k)).map(S);c(e)}catch(e){console.error("Error refreshing bookings:",e),m("Failed to refresh bookings")}},w=(0,r.useCallback)(e=>{let n=e.booking;n&&t?t(n):n&&alert("Selected: ".concat(e.title,"\nStatus: ").concat(n.confirmed?"Confirmed":"Pending"))},[t]),N=(0,r.useCallback)(()=>{alert("To schedule a new lesson, please contact your tutor or use the booking system.")},[]);if("student"!==b||!f)return(0,s.jsx)("div",{className:u().container,children:(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:"Not authorized. Please log in as a student."})});if(h)return(0,s.jsx)("div",{className:u().container,children:(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:"Loading lessons..."})});if(p)return(0,s.jsx)("div",{className:u().container,children:(0,s.jsxs)("div",{style:{textAlign:"center",padding:"20px",color:"red"},children:["Error: ",p,(0,s.jsx)("button",{onClick:_,style:{marginLeft:10},children:"Retry"})]})});let C=l.filter(e=>new Date(e.start)>=new Date).sort((e,n)=>new Date(e.start).getTime()-new Date(n.start).getTime()),D=l.filter(e=>new Date(e.start)<new Date).sort((e,n)=>new Date(n.start).getTime()-new Date(e.start).getTime());return(0,s.jsxs)("div",{className:u().container,children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,s.jsx)("h2",{className:u().title,children:"My Lessons Calendar"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,s.jsxs)("span",{style:{fontSize:"14px",color:"#666"},children:[(null==y||null==(n=y.subjects)?void 0:n.length)||0," Subjects |"," ",l.filter(e=>{var n;return null==(n=e.booking)?void 0:n.confirmed}).length," Confirmed |"," ",C.length," Upcoming"]}),(0,s.jsx)("button",{onClick:_,style:{padding:"8px 16px",cursor:"pointer",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"6px",transition:"background-color 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#7c3aed",onMouseOut:e=>e.currentTarget.style.backgroundColor="#8b5cf6",children:"Refresh"})]})]}),(0,s.jsxs)("div",{className:u().instructions,children:[(0,s.jsx)("h4",{className:u().instructionsTitle,children:"Calendar Guide:"}),(0,s.jsxs)("ul",{className:u().instructionsList,children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{style:{color:"#8b5cf6",fontWeight:"bold"},children:"Purple"})," - Confirmed lessons (click to join)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"bold"},children:"Grey"})," - Pending confirmation"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{style:{color:"#10b981",fontWeight:"bold"},children:"Green"})," - Completed lessons"]})]})]}),(0,s.jsx)("div",{className:u().calendarWrapper,style:{height:"600px"},children:(0,s.jsx)(o.Vv,{localizer:g,events:l,startAccessor:"start",endAccessor:"end",views:["week","day","month"],defaultView:"week",min:new Date(2025,0,1,7,0),max:new Date(2030,11,31,22,0),step:30,timeslots:2,style:{height:"100%"},onSelectEvent:w,onSelectSlot:N,selectable:!0,eventPropGetter:()=>({style:{backgroundColor:"transparent",border:"none",padding:0}})})}),(0,s.jsxs)("div",{className:u().currentEvents,style:{position:"relative"},children:[(0,s.jsxs)("h4",{className:u().currentEventsTitle,children:["Upcoming Lessons (",C.length,"):"]}),(0,s.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto",overflowX:"hidden",padding:"8px",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"#fafafa",position:"relative"},children:0===C.length?(0,s.jsx)("div",{style:{fontStyle:"italic",color:"#666",textAlign:"center",padding:"20px"},children:"No upcoming lessons scheduled"}):C.map(e=>{var n,r,a,i,o,l,c;return(0,s.jsxs)("div",{className:u().eventItem,style:{marginBottom:"12px",padding:"12px",backgroundColor:"white",borderRadius:"6px",border:"1px solid #e5e7eb",transition:"all 0.2s ease",cursor:"pointer"},onClick:()=>e.booking&&t&&t(e.booking),onMouseOver:e=>{e.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("strong",{style:{color:"#1e293b",fontSize:"14px"},children:(null==(n=e.booking)?void 0:n.subject)||e.title}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{style:{fontSize:"12px",color:"#64748b"},children:d()(e.start).format("MMM D, YYYY h:mm A")}),(null==(r=e.booking)?void 0:r.durationMinutes)&&(0,s.jsxs)("span",{style:{fontSize:"12px",color:"#64748b",marginLeft:"8px"},children:["(",e.booking.durationMinutes," min)"]})]}),(0,s.jsx)("span",{style:{padding:"3px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",backgroundColor:(null==(a=e.booking)?void 0:a.confirmed)?"#dcfce7":"#f3f4f6",color:(null==(i=e.booking)?void 0:i.confirmed)?"#166534":"#6b7280",whiteSpace:"nowrap"},children:(null==(o=e.booking)?void 0:o.confirmed)?"Confirmed":"Pending"})]}),(null==(l=e.booking)?void 0:l.extraDetails)&&(0,s.jsx)("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"6px",padding:"6px",backgroundColor:"#f8fafc",borderRadius:"4px"},children:e.booking.extraDetails}),(null==(c=e.booking)?void 0:c.meetingLink)&&(0,s.jsx)("button",{onClick:n=>{n.stopPropagation(),window.open(e.booking.meetingLink,"_blank")},style:{fontSize:"12px",color:"#3b82f6",background:"none",border:"none",padding:"4px 0",cursor:"pointer",textDecoration:"underline",marginTop:"4px"},children:"Join Meeting →"})]},e.id)})})]}),D.length>0&&(0,s.jsxs)("div",{className:u().pastEvents,style:{marginTop:"20px"},children:[(0,s.jsxs)("h4",{className:u().pastEventsTitle,style:{color:"#64748b",fontSize:"14px"},children:["Recent Past Lessons (",D.slice(0,5).length," of ",D.length,"):"]}),(0,s.jsx)("div",{style:{opacity:.7},children:D.slice(0,5).map(e=>{var n;return(0,s.jsxs)("div",{style:{fontSize:"12px",padding:"4px 0",borderBottom:"1px solid #f1f5f9"},children:[(0,s.jsx)("span",{children:null==(n=e.booking)?void 0:n.subject})," -",(0,s.jsx)("span",{style:{marginLeft:"4px",color:"#94a3b8"},children:d()(e.start).format("MMM D")})]},e.id)})})]})]})};var x=t(8477);let p=e=>{let{booking:n,student:t,onClose:r,onJoin:a}=e,i=new Date(n.date.year,n.date.month-1,n.date.day,n.date.hour,n.date.minute),o=new Date(i.getTime()+36e5),l=(0,s.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:(0,s.jsxs)("div",{style:{background:"white",borderRadius:10,width:"min(720px, 96%)",maxHeight:"90vh",overflowY:"auto",padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,s.jsx)("h2",{style:{margin:0},children:"Booking Details"}),(0,s.jsx)("button",{onClick:r,style:{fontSize:22,lineHeight:1,border:"none",background:"transparent",cursor:"pointer"},children:"\xd7"})]}),(0,s.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Subject:"}),(0,s.jsx)("span",{children:n.subject})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Time:"}),(0,s.jsx)("span",{children:"".concat(d()(i).format("h:mm A")," - ").concat(d()(o).format("h:mm A"),", ").concat(d()(i).format("MMMM D, YYYY"))})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Booking ID:"}),(0,s.jsx)("span",{style:{fontFamily:"monospace"},children:n.bookingId})]}),(0,s.jsxs)("div",{style:{padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Parent:"}),(0,s.jsx)("div",{children:t.parentName}),(0,s.jsx)("div",{style:{fontSize:13,color:"#666"},children:t.parentContactNumber}),(0,s.jsx)("div",{style:{fontSize:13,color:"#666"},children:t.parentEmail})]}),n.extraDetails&&(0,s.jsxs)("div",{style:{padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Notes:"}),(0,s.jsx)("div",{style:{marginTop:8},children:n.extraDetails})]}),n.meetingLink&&(0,s.jsxs)("div",{style:{padding:12,background:"#f7f7f7",borderRadius:8},children:[(0,s.jsx)("strong",{children:"Meeting Link:"}),(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)("a",{href:n.meetingLink,target:"_blank",rel:"noopener noreferrer",children:n.meetingLink})})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,marginTop:18},children:[(0,s.jsx)("button",{onClick:()=>{a?a():n.meetingLink&&window.open(n.meetingLink,"_blank","noopener,noreferrer")},style:{flex:1,background:"#7c3aed",color:"white",padding:"12px 16px",borderRadius:8,border:"none",cursor:"pointer"},children:n.meetingLink?"Join Lesson":"No Meeting Link"}),(0,s.jsx)("button",{onClick:r,style:{flex:1,background:"#e5e7eb",padding:"12px 16px",borderRadius:8,border:"none",cursor:"pointer"},children:"Close"})]})]})}),c="undefined"!=typeof document?document.body:null;return c?x.createPortal(l,c):null};var m=t(4814),f=t.n(m);let b=e=>{var n,t,o;let{navigation:l}=e,{user:c,userType:u,userProfile:g,studentProfile:x,isLoading:m}=(0,a.ur)(),b=(0,i.j)(),j={studentId:(null==b?void 0:b.studentId)||"",username:null!=(n=null==g?void 0:g.displayName)?n:"",password:"",role:"student",grade:String(null!=(t=null==x?void 0:x.grade)?t:12),email:null==g?void 0:g.email,subjects:(null!=(o=null==x?void 0:x.subjects)?o:[]).map(e=>"string"==typeof e?{subjectName:e,tutorId:"",currentMark:0,targetMark:0}:e),tutorIds:[],parentId:"",parentName:"",parentContactNumber:"",parentEmail:"",tokens:0},[y,v]=(0,r.useState)(null),[k,S]=(0,r.useState)(!1),[_,w]=(0,r.useState)(0),[N,C]=(0,r.useState)(!1),[D,L]=(0,r.useState)({upcomingLessons:0,completedThisMonth:0,studyHours:0,upcomingDeadlines:0}),[T,I]=(0,r.useState)({weeklyLessons:0,weeklyHours:0,weeklyProgress:0,completedThisWeek:0}),[M,H]=(0,r.useState)({totalLessons:0,completedAssignments:0,currentSubjects:0,averageGrade:0,upcomingLessons:0});return((0,r.useEffect)(()=>{(async()=>{if(!(null==b?void 0:b.studentId))return console.log("No studentId available yet");if(N)return console.log("Already loading stats, skipping...");C(!0);try{let[e,n,t,s]=await Promise.all([b.calculateWeeklyStats(b.studentId),b.calculateStudentStats(b.studentId),b.fetchStudentBookings(b.studentId),b.fetchStudentLessons(b.studentId)]);I(e),H(n);let r=new Date,a=d()().startOf("month").toDate(),i=d()().endOf("month").toDate(),o=s.filter(e=>{let n=new Date(e.date.year,e.date.month-1,e.date.day,e.date.hour||0,e.date.minute||0);return n>=a&&n<=i&&"completed"===e.lessonStatus}).length,l=new Date;l.setDate(l.getDate()+7);let c=t.filter(e=>{let n=new Date(e.date.year,e.date.month-1,e.date.day,e.date.hour||0,e.date.minute||0);return n>=r&&n<=l&&e.confirmed}).length;L({upcomingLessons:e.weeklyLessons,completedThisMonth:o,studyHours:Math.round(e.weeklyHours),upcomingDeadlines:c})}catch(e){console.error("Error loading dashboard data:",e)}finally{C(!1)}})()},[null==b?void 0:b.studentId]),!m&&(null==b?void 0:b.studentId))?"student"===u&&c?(0,s.jsxs)("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #ddd6fe 100%)"},children:[(0,s.jsxs)("div",{className:f().container,children:[(0,s.jsx)("h1",{className:f().heading,children:"Student Dashboard"}),(0,s.jsxs)("div",{className:f().infoBoxes,children:[(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Upcoming Lessons"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):"".concat(D.upcomingLessons," this week")})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Completed"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):"".concat(D.completedThisMonth," this month")})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Study Hours"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):(e=>{if(0===e)return"0";if(e<1)return"".concat(Math.round(60*e),"m");let n=Math.floor(e),t=Math.round((e-n)*60);return 0===t?"".concat(n,"h"):"".concat(n,"h ").concat(t,"m")})(T.weeklyHours)})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Average Grade"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):"".concat(M.averageGrade,"%")})]})]}),(0,s.jsxs)("div",{className:f().infoBoxes,style:{marginTop:"1rem"},children:[(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Weekly Progress"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):"".concat(T.weeklyProgress,"%")})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Active Subjects"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):M.currentSubjects})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Total Lessons"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):M.totalLessons})]}),(0,s.jsxs)("div",{className:f().box,children:[(0,s.jsx)("h2",{children:"Assignments Done"}),(0,s.jsx)("p",{children:N?(0,s.jsx)("span",{className:f().loadingStats,children:"..."}):M.completedAssignments})]})]}),(0,s.jsxs)("div",{className:f().calendarWrapper,children:[(0,s.jsx)("h2",{className:f().calendarTitle,children:"Your Schedule"}),(0,s.jsx)(h,{onLessonClick:e=>{console.log("Parent received booking click:",e);let n=Number(e.date.year),t=Number(e.date.month)-1,s=Number(e.date.day),r=new Date(n,t,s,Number(e.date.hour),Number(e.date.minute)),a=new Date;a.setHours(0,0,0,0),!isNaN(r.getTime())&&r>=a?(v(e),S(!0)):console.log("Booking is in the past — not opening modal:",e.bookingId)}},_)]})]}),k&&y&&(0,s.jsx)(p,{booking:y,student:j,onClose:()=>{S(!1),v(null)},onJoin:()=>{y&&(y.meetingLink?window.open(y.meetingLink,"_blank","noopener,noreferrer"):alert("No meeting link available for this booking."))}})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #ddd6fe 100%)"},children:(0,s.jsx)("div",{className:f().notStudentMessage,children:"Not a Student or profile not loaded."})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #ddd6fe 100%)"},children:(0,s.jsxs)("div",{className:f().loadingContent,children:[(0,s.jsx)("div",{className:f().loadingSpinner}),(0,s.jsx)("p",{className:f().loadingText,children:"Loading dashboard..."})]})})},j=b},4814:e=>{e.exports={container:"StudentHome_container__ZdoNZ",fadeInUp:"StudentHome_fadeInUp__qC9Ya",heading:"StudentHome_heading__3uX1f",infoBoxes:"StudentHome_infoBoxes__83hIz",box:"StudentHome_box__W8Q9V",fadeInScale:"StudentHome_fadeInScale__G2k8H",calendarWrapper:"StudentHome_calendarWrapper__VBgPU",calendarTitle:"StudentHome_calendarTitle__YTfW4",loadingStats:"StudentHome_loadingStats__dMUOm",pulse:"StudentHome_pulse__n9QtA"}}}]);