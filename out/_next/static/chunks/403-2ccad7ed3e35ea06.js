(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[403],{387:e=>{e.exports={overlay:"AddStudentModal_overlay__wu8xo",modal:"AddStudentModal_modal__1sg5z",header:"AddStudentModal_header__F0lQP",headerContent:"AddStudentModal_headerContent__qEFmm",headerIcon:"AddStudentModal_headerIcon__fLNV9",title:"AddStudentModal_title__CZ5il",subtitle:"AddStudentModal_subtitle__tZElu",closeButton:"AddStudentModal_closeButton__pGIKW",content:"AddStudentModal_content__YdUJt",errorMessage:"AddStudentModal_errorMessage__Jofgd",formGroup:"AddStudentModal_formGroup__hi1Yj",label:"AddStudentModal_label__vKBI1",labelIcon:"AddStudentModal_labelIcon__GdJRx",select:"AddStudentModal_select__YegaT",noStudents:"AddStudentModal_noStudents__DXCig",selectedInfo:"AddStudentModal_selectedInfo__P851D",selectedTitle:"AddStudentModal_selectedTitle__2Nnpj",selectedDetails:"AddStudentModal_selectedDetails__qaNYy",footer:"AddStudentModal_footer__zpBAM",cancelButton:"AddStudentModal_cancelButton__tEdCN",addButton:"AddStudentModal_addButton__xrNAv",iconSize:"AddStudentModal_iconSize__bf0qd"}},3044:e=>{e.exports={container:"TutorHome_container__RFroG",mainContent:"TutorHome_mainContent__WdW4L",header:"TutorHome_header__Pc3ut",headerContent:"TutorHome_headerContent__sNyti",headerInfo:"TutorHome_headerInfo__PMJPr",pageTitle:"TutorHome_pageTitle__vXqx3",pageSubtitle:"TutorHome_pageSubtitle__U1bV6",headerActions:"TutorHome_headerActions__TCaE2",notificationButton:"TutorHome_notificationButton__b1n8Y",notificationIcon:"TutorHome_notificationIcon___a9xG",notificationBadge:"TutorHome_notificationBadge___maqq",settingsButton:"TutorHome_settingsButton__D9b4M",settingsIcon:"TutorHome_settingsIcon___T27M",sectionTitle:"TutorHome_sectionTitle___FLZP",sectionSubtitle:"TutorHome_sectionSubtitle__yLrEm",statsSection:"TutorHome_statsSection__YOcpZ",statsGrid:"TutorHome_statsGrid__UTB_1",statCard:"TutorHome_statCard__YjuHd",statCardBlue:"TutorHome_statCardBlue__fvi9k",statCardGreen:"TutorHome_statCardGreen__rW0e5",statCardPurple:"TutorHome_statCardPurple__2rQtF",statCardOrange:"TutorHome_statCardOrange__vC2VV",statContent:"TutorHome_statContent__KWMHy",statIcon:"TutorHome_statIcon__vf3Dj",statDetails:"TutorHome_statDetails__6KT2Z",statValue:"TutorHome_statValue__iyVlS",statTitle:"TutorHome_statTitle__YpQ5I",statSubtitle:"TutorHome_statSubtitle__PjdNW",iconSize:"TutorHome_iconSize__QxhGZ",quickActionsSection:"TutorHome_quickActionsSection__WVtNq",quickActionsGrid:"TutorHome_quickActionsGrid__eTFML",quickAction:"TutorHome_quickAction__p6Qqb",quickActionBlue:"TutorHome_quickActionBlue___RUEO",quickActionGreen:"TutorHome_quickActionGreen__aRIPC",quickActionPurple:"TutorHome_quickActionPurple__D7Avl",quickActionOrange:"TutorHome_quickActionOrange__75TNS",actionIcon:"TutorHome_actionIcon__PBSuu",actionLabel:"TutorHome_actionLabel__duJyt",infoSection:"TutorHome_infoSection__NM8f8",infoGrid:"TutorHome_infoGrid__wR72M",infoCard:"TutorHome_infoCard__nNMc_",infoHeader:"TutorHome_infoHeader__LdzJx",infoIcon:"TutorHome_infoIcon__zGTXQ",infoIconBlue:"TutorHome_infoIconBlue__ZTpmD",infoIconGreen:"TutorHome_infoIconGreen__Bu2SA",infoIconOrange:"TutorHome_infoIconOrange__OQtIn",infoTitle:"TutorHome_infoTitle__iaGS5",infoContent:"TutorHome_infoContent__rQKU_",infoText:"TutorHome_infoText__28KOz",infoAction:"TutorHome_infoAction__llS_c",calendarSection:"TutorHome_calendarSection__6Cqiu",calendarHeader:"TutorHome_calendarHeader__HrERE",calendarSubtitle:"TutorHome_calendarSubtitle__fMGFK",calendarContainer:"TutorHome_calendarContainer__wx_Hl",calendarPlaceholder:"TutorHome_calendarPlaceholder__19MvN",calendarIcon:"TutorHome_calendarIcon__awfzn",calendarText:"TutorHome_calendarText__vIhDS",calendarSubtext:"TutorHome_calendarSubtext__0olGy",fadeInUp:"TutorHome_fadeInUp__YHNTJ",loading:"TutorHome_loading__97SED",notTutorMessage:"TutorHome_notTutorMessage__8FvLh",textCenter:"TutorHome_textCenter__GLnlE",hidden:"TutorHome_hidden__pVnFr",visible:"TutorHome_visible__hKvuu"}},5217:e=>{e.exports={modalOverlay:"bookingModal_modalOverlay__KhNYm",modalContainer:"bookingModal_modalContainer__cPN1N",header:"bookingModal_header__VGJAx",headerTitle:"bookingModal_headerTitle__zqXaT",closeButton:"bookingModal_closeButton___bcd9",body:"bookingModal_body__Zs9v_",label:"bookingModal_label__qxyVz",infoBox:"bookingModal_infoBox__mOrb1",meetingSection:"bookingModal_meetingSection__71PSm",meetingLabel:"bookingModal_meetingLabel__KMyTH",joinButton:"bookingModal_joinButton__Ec6va"}},6447:e=>{e.exports={container:"calendarTutor_container__LH3_f",title:"calendarTutor_title___Nkr4",instructions:"calendarTutor_instructions__F_u13",instructionsTitle:"calendarTutor_instructionsTitle__kcjqe",instructionsList:"calendarTutor_instructionsList__mrlu1",calendarWrapper:"calendarTutor_calendarWrapper__3S2tq",currentEvents:"calendarTutor_currentEvents__heVDw",currentEventsTitle:"calendarTutor_currentEventsTitle__BybDq",eventsList:"calendarTutor_eventsList__wDACL",eventItem:"calendarTutor_eventItem__mAEy_"}},8439:e=>{e.exports={overlay:"createLessonModal_overlay__R9s4b",modal:"createLessonModal_modal__QL3WT",header:"createLessonModal_header__l_kW_",closeBtn:"createLessonModal_closeBtn__oj5WT",form:"createLessonModal_form__JylNx",info:"createLessonModal_info__kdyz2",error:"createLessonModal_error___C29o",label:"createLessonModal_label__Hry85",select:"createLessonModal_select__9bVk3",input:"createLessonModal_input__3G7tq",textarea:"createLessonModal_textarea__0V7Ae",buttonGroup:"createLessonModal_buttonGroup__jdq3k",cancelBtn:"createLessonModal_cancelBtn__oZjn6",submitBtn:"createLessonModal_submitBtn__GAc0r"}},8603:e=>{e.exports={modalOverlay:"confirmationModal_modalOverlay__0Zyom",fadeIn:"confirmationModal_fadeIn__0IiEY",modalContent:"confirmationModal_modalContent__9_2_N",slideUp:"confirmationModal_slideUp__10whA",modalHeader:"confirmationModal_modalHeader__3_kvm",modalTitle:"confirmationModal_modalTitle__cvZrB",closeButton:"confirmationModal_closeButton__2n8a1",modalBody:"confirmationModal_modalBody__9OGnf",bookingDetails:"confirmationModal_bookingDetails__gNqtT",detailRow:"confirmationModal_detailRow__WR_e4",detailIcon:"confirmationModal_detailIcon___6zIt",detailContent:"confirmationModal_detailContent__ATIij",detailLabel:"confirmationModal_detailLabel__4wFdR",detailValue:"confirmationModal_detailValue__JadCS",meetingLink:"confirmationModal_meetingLink__zrRum",statusMessage:"confirmationModal_statusMessage__cciUO",success:"confirmationModal_success__58a0I",error:"confirmationModal_error__XQIlB",statusIcon:"confirmationModal_statusIcon__oRyGQ",statusText:"confirmationModal_statusText__HMgd8",statusLink:"confirmationModal_statusLink__qL5ZS",modalFooter:"confirmationModal_modalFooter__TSvnT",button:"confirmationModal_button__5Bz30",cancelButton:"confirmationModal_cancelButton__WvxkR",confirmButton:"confirmationModal_confirmButton__WmtjC",deleteButton:"confirmationModal_deleteButton__TWO5O",spinner:"confirmationModal_spinner__a9HTi",spin:"confirmationModal_spin__LfRr1"}},9249:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});var o=n(4232),s=n(2964),a=n(6362),l=n(9999);let r=()=>{let{userProfile:e,tutorProfile:t,userType:n}=(0,l.ur)(),[r,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)(null),u=null==e?void 0:e.uid,m=()=>{let e=new Date,t=e.getDay(),n=new Date(e);n.setDate(e.getDate()-(0===t?6:t-1)),n.setHours(0,0,0,0);let o=new Date(n);return o.setDate(n.getDate()+6),o.setHours(23,59,59,999),{start:n,end:o}},_=e=>{let{start:t,end:n}=m(),o=new Date(e.date.year,e.date.month-1,e.date.day,e.date.hour,e.date.minute);return o>=t&&o<=n},h=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID provided for fetchTutorBookings"),d("Tutor ID is required"),[];i(!0),d(null);try{let e=(0,s.rJ)(a.db,"bookings"),n=(0,s.P)(e,(0,s._M)("tutorId","==",t)),o=await (0,s.GG)(n),l=[];return o.forEach(e=>{l.push({...e.data(),bookingId:e.id})}),l}catch(e){return console.error("[useTutor] Error fetching bookings:",e),d(e.message||"Failed to fetch bookings"),[]}finally{i(!1)}},[u]),g=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID provided for fetchTutorStudents"),d("Tutor ID is required"),[];i(!0),d(null);try{let e=(0,s.rJ)(a.db,"bookings"),n=(0,s.P)(e,(0,s._M)("tutorId","==",t)),o=await (0,s.GG)(n),l=new Set;if(o.forEach(e=>{let t=e.data();t.studentId&&l.add(t.studentId)}),0===l.size)return[];let r=(0,s.rJ)(a.db,"students"),i=await (0,s.GG)(r),c=[];return i.forEach(e=>{l.has(e.id)&&c.push({...e.data(),uid:e.id})}),c}catch(e){return console.error("[useTutor] Error fetching students:",e),d(e.message||"Failed to fetch students"),[]}finally{i(!1)}},[u]),f=(0,o.useCallback)(async e=>{let n=e||u;if(!n)return console.error("[useTutor] No tutor ID for calculateWeeklyEarnings"),0;try{let e=(0,s.rJ)(a.db,"bookings"),o=(0,s.P)(e,(0,s._M)("tutorId","==",n),(0,s._M)("confirmed","==",!0)),l=await (0,s.GG)(o),r=0;l.forEach(e=>{let t=e.data();_(t)&&r++});let i=(null==t?void 0:t.hourlyRate)||0,c=r*i;return console.log("[useTutor] Weekly earnings calculated:",{weeklyLessons:r,hourlyRate:i,weeklyEarnings:c}),c}catch(e){return console.error("[useTutor] Error calculating weekly earnings:",e),0}},[u,null==t?void 0:t.hourlyRate]),x=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for calculateWeeklyHours"),0;try{let e=(0,s.rJ)(a.db,"bookings"),n=(0,s.P)(e,(0,s._M)("tutorId","==",t),(0,s._M)("confirmed","==",!0)),o=await (0,s.GG)(n),l=0;o.forEach(e=>{let t=e.data();if(_(t)){let e=t.durationMinutes||60;l+=e}});let r=l/60;return console.log("[useTutor] Weekly hours calculated:",{weeklyMinutes:l,weeklyHours:r}),r}catch(e){return console.error("[useTutor] Error calculating weekly hours:",e),0}},[u]),b=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for calculateWeeklyLessons"),0;try{let e=(0,s.rJ)(a.db,"bookings"),n=(0,s.P)(e,(0,s._M)("tutorId","==",t)),o=await (0,s.GG)(n),l=0;return o.forEach(e=>{let t=e.data();_(t)&&l++}),console.log("[useTutor] Weekly lessons calculated:",l),l}catch(e){return console.error("[useTutor] Error calculating weekly lessons:",e),0}},[u]),j=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for fetchWeeklyStatistics"),{weeklyEarnings:0,weeklyHours:0,weeklyLessons:0};i(!0),d(null);try{let[e,n,o]=await Promise.all([f(t),x(t),b(t)]),s={weeklyEarnings:e,weeklyHours:n,weeklyLessons:o};return console.log("[useTutor] Weekly statistics fetched:",s),s}catch(e){return console.error("[useTutor] Error fetching weekly statistics:",e),d(e.message||"Failed to fetch weekly statistics"),{weeklyEarnings:0,weeklyHours:0,weeklyLessons:0}}finally{i(!1)}},[u,f,x,b]),p=(0,o.useCallback)(async e=>{let n=e||u;if(!n)return console.error("[useTutor] No tutor ID for calculateTotalEarnings"),0;try{let e=(0,s.rJ)(a.db,"bookings"),o=(0,s.P)(e,(0,s._M)("tutorId","==",n),(0,s._M)("confirmed","==",!0)),l=(await (0,s.GG)(o)).size,r=(null==t?void 0:t.hourlyRate)||0,i=l*r;return console.log("[useTutor] Total earnings calculated:",{confirmedLessons:l,hourlyRate:r,totalEarnings:i}),i}catch(e){return console.error("[useTutor] Error calculating total earnings:",e),0}},[u,null==t?void 0:t.hourlyRate]),v=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for calculateTotalHours"),0;try{let e=(0,s.rJ)(a.db,"bookings"),n=(0,s.P)(e,(0,s._M)("tutorId","==",t),(0,s._M)("confirmed","==",!0)),o=await (0,s.GG)(n),l=0;o.forEach(e=>{let t=e.data().durationMinutes||60;l+=t});let r=l/60;return console.log("[useTutor] Total hours calculated:",{totalMinutes:l,totalHours:r}),r}catch(e){return console.error("[useTutor] Error calculating total hours:",e),0}},[u]),y=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for calculateTotalStudents"),0;try{let e=(0,s.H9)(a.db,"tutors",t),n=await (0,s.x7)(e);if(!n.exists())return console.log("[useTutor] Tutor document not found"),0;let o=n.data().studentIds||[],l=Array.isArray(o)?o.length:0;return console.log("[useTutor] Total students from studentIds array:",l),l}catch(e){return console.error("[useTutor] Error calculating total students:",e),0}},[u]),N=(0,o.useCallback)(async e=>{let t=e||u;if(!t)return console.error("[useTutor] No tutor ID for fetchTotalStatistics"),{totalEarnings:0,totalHours:0,totalStudents:0};i(!0),d(null);try{let[e,n,o]=await Promise.all([p(t),v(t),y(t)]),s={totalEarnings:e,totalHours:n,totalStudents:o};return console.log("[useTutor] Total statistics fetched:",s),s}catch(e){return console.error("[useTutor] Error fetching total statistics:",e),d(e.message||"Failed to fetch total statistics"),{totalEarnings:0,totalHours:0,totalStudents:0}}finally{i(!1)}},[u,p,v,y]);return{tutorUserId:u,tutorProfile:t,fetchTutorBookings:h,fetchTutorStudents:g,calculateWeeklyEarnings:f,calculateWeeklyHours:x,calculateWeeklyLessons:b,fetchWeeklyStatistics:j,calculateTotalEarnings:p,calculateTotalHours:v,calculateTotalStudents:y,fetchTotalStatistics:N,fetchTutorStatistics:N,loading:r,error:c,isTutor:"tutor"===n}}},9347:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TutorHome:()=>Y,default:()=>V});var o=n(7876),s=n(4232),a=n(710),l=n(3654),r=n(5952),i=n(7396),c=n(5037),d=n(3274),u=n(9999),m=n(9249),_=n(523),h=n(841),g=n.n(h);n(2287);var f=n(6447),x=n.n(f),b=n(8439),j=n.n(b),p=n(2964),v=n(6362);let y=e=>{let{selectedDate:t,onClose:n,onSubmit:a}=e,[l,r]=(0,s.useState)([]),[i,c]=(0,s.useState)(""),[d,m]=(0,s.useState)(""),[_,h]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[x,b]=(0,s.useState)(60),[y,N]=(0,s.useState)(!1),[k,T]=(0,s.useState)(null),{userProfile:S,tutorProfile:C,userType:M}=(0,u.ur)(),w=(null==S?void 0:S.uid)||"",I="tutor"===M;(0,s.useEffect)(()=>{(async()=>{if(!w||!I){console.log("Not a tutor or tutorId not available"),r([]);return}try{console.log("Fetching students for tutor:",w);let e=await (0,p.GG)((0,p.rJ)(v.db,"students")),t=[];e.forEach(e=>{let n={...e.data(),uid:e.id};t.push(n)});let n=await (0,p.GG)((0,p.rJ)(v.db,"users")),o=new Map;n.forEach(e=>{let t={...e.data(),uid:e.id};o.set(e.id,t)});let s=t.filter(e=>e.subjects.some(e=>e.tutorId===w)),a=s;if(0===s.length){let e=await (0,p.GG)((0,p.P)((0,p.rJ)(v.db,"bookings"),(0,p._M)("tutorId","==",w))),n=new Set;e.forEach(e=>{let t=e.data();t.studentId&&n.add(t.studentId)}),a=t.filter(e=>n.has(e.uid))}let l=a.map(e=>{let t=o.get(e.uid);return{...e,displayName:null==t?void 0:t.displayName,email:null==t?void 0:t.email}});console.log("Students with profiles:",l),r(l)}catch(e){console.error("Failed to fetch students with profiles",e),r([])}})()},[w,I]),(0,s.useEffect)(()=>{let e=l.find(e=>e.uid===i);e&&m(e.email||"")},[i,l]);let A=s.useMemo(()=>{let e=l.find(e=>e.uid===i);return e&&e.subjects?e.subjects.filter(e=>e.tutorId===w).map(e=>e.subjectName).filter(e=>"string"==typeof e&&e.length>0):[]},[l,i,w]),H=async e=>{if(e.preventDefault(),!i||!_)return void T("Please select a student and subject");if(!w)return void T("Tutor ID not found. Please log in again.");N(!0),T(null);let o={tutorId:w,studentId:i,date:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours(),minute:t.getMinutes()},subject:_,extraDetails:g,durationMinutes:x,confirmed:!1};try{if(!o.tutorId||!o.studentId)throw Error("Missing required fields: tutorId or studentId");let e=(await (0,p.gS)((0,p.rJ)(v.db,"bookings"),o)).id;await (0,p.mZ)((0,p.H9)(v.db,"bookings",e),{bookingId:e,studentEmail:d||null,tutorEmail:(null==S?void 0:S.email)||null});let t={...o,bookingId:e};console.log("Booking created successfully:",t),a(t),n()}catch(e){console.error("Error creating booking:",e),T(e.message||"Failed to create booking. Please try again.")}finally{N(!1)}};return I?(0,o.jsx)("div",{className:j().overlay,children:(0,o.jsxs)("div",{className:j().modal,children:[(0,o.jsxs)("header",{className:j().header,children:[(0,o.jsx)("h2",{children:"Create Lesson"}),(0,o.jsx)("button",{className:j().closeBtn,onClick:n,disabled:y,children:"\xd7"})]}),(0,o.jsxs)("form",{className:j().form,onSubmit:H,children:[(0,o.jsxs)("div",{className:j().info,style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"15px",border:"1px solid #2196f3"},children:[(0,o.jsx)("strong",{children:"ℹ️ How it works:"}),(0,o.jsx)("br",{}),(0,o.jsxs)("small",{children:["1. Create the lesson booking here",(0,o.jsx)("br",{}),'2. The lesson will appear in your calendar as "unconfirmed"',(0,o.jsx)("br",{}),"3. Click on the lesson to confirm it and create a Teams meeting",(0,o.jsx)("br",{}),"4. Share the meeting link with your student"]})]}),!w&&(0,o.jsx)("div",{className:j().error,children:"Warning: Tutor ID not found. Please refresh the page or log in again."}),(0,o.jsx)("label",{className:j().label,htmlFor:"student-select",children:"Student:"}),(0,o.jsxs)("select",{id:"student-select",className:j().select,value:i,onChange:e=>{c(e.target.value),h("")},required:!0,children:[(0,o.jsx)("option",{value:"",disabled:!0,children:l.length?"Select student":"Loading students..."}),l.map(e=>(0,o.jsxs)("option",{value:e.uid,children:[e.displayName||"Student ".concat(e.uid),e.grade?" - Grade ".concat(e.grade):"",e.email?" (".concat(e.email,")"):""]},e.uid))]}),(0,o.jsx)("label",{className:j().label,htmlFor:"subject-select",children:"Subject:"}),(0,o.jsxs)("select",{id:"subject-select",className:j().select,value:_,onChange:e=>h(e.target.value),required:!0,disabled:!i,children:[(0,o.jsx)("option",{value:"",disabled:!0,children:i?A.length?"Select subject":"No subjects assigned to you for this student":"Select a student first"}),A.map(e=>(0,o.jsx)("option",{value:e,children:e},e))]}),(0,o.jsx)("label",{className:j().label,htmlFor:"duration",children:"Duration (minutes):"}),(0,o.jsx)("input",{id:"duration",type:"number",min:15,step:15,className:j().input,value:x,onChange:e=>b(Number(e.target.value))}),(0,o.jsx)("label",{className:j().label,htmlFor:"details-text",children:"Extra Details (Optional):"}),(0,o.jsx)("textarea",{id:"details-text",className:j().textarea,value:g,onChange:e=>f(e.target.value),rows:4,placeholder:"Any additional notes for this lesson..."}),k&&(0,o.jsx)("div",{className:j().error,children:k}),(0,o.jsxs)("div",{className:j().buttonGroup,style:{display:"flex",gap:"10px",marginTop:"20px"},children:[(0,o.jsx)("button",{type:"button",className:j().cancelBtn,onClick:n,disabled:y,style:{flex:1,padding:"10px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"},children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:j().submitBtn,disabled:y||!w,style:{flex:2,padding:"10px",background:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:y?"not-allowed":"pointer",opacity:y?.7:1},children:y?"Creating Booking...":"Create Booking"})]})]})]})}):(0,o.jsx)("div",{className:j().overlay,children:(0,o.jsxs)("div",{className:j().modal,children:[(0,o.jsxs)("header",{className:j().header,children:[(0,o.jsx)("h2",{children:"Access Denied"}),(0,o.jsx)("button",{className:j().closeBtn,onClick:n,children:"\xd7"})]}),(0,o.jsx)("div",{className:j().form,children:(0,o.jsx)("p",{children:"Only tutors can create lessons."})})]})})},N=(0,_.ye)(g()),k=e=>{var t;let{onLessonClick:n}=e,[a,l]=(0,s.useState)(!1),[r,i]=(0,s.useState)(null),[c,d]=(0,s.useState)([]),[h,f]=(0,s.useState)(!0),[b,j]=(0,s.useState)(null),{user:p,userType:v,userProfile:k,tutorProfile:T}=(0,u.ur)(),{fetchTutorBookings:S}=(0,m.q)(),C=(null==k?void 0:k.uid)||"",M=e=>{let{date:t}=e,n=new Date(t.year,t.month-1,t.day,t.hour,t.minute),o=e.durationMinutes||60,s=new Date(n.getTime()+60*o*1e3);return{id:e.bookingId,title:"".concat(e.subject).concat(e.confirmed?"":" (Pending)"),start:n,end:s,type:e.confirmed?"lesson":"pending-lesson",clickable:!0,booking:e}};(0,s.useEffect)(()=>{(async()=>{if(!C)return f(!1);try{f(!0),j(null);let e=(await S(C)).map(M);d(e)}catch(e){console.error("Error fetching bookings:",e),j("Failed to load bookings")}finally{f(!1)}})()},[S,C]);let w=async()=>{if(C)try{let e=(await S(C)).map(M);d(e)}catch(e){console.error("Error refreshing bookings:",e),j("Failed to refresh bookings")}},I=(0,s.useCallback)(e=>{i(e.start),l(!0)},[]),A=()=>{l(!1),i(null)},H=async e=>{let t=M(e);d(e=>[...e,t]),A(),await w(),console.log("New lesson created:",e)},L=(0,s.useCallback)(e=>{console.log("Selected event:",e);let t=e.booking;t&&n?n(t):t?alert("Selected: ".concat(e.title,"\nStatus: ").concat(t.confirmed?"Confirmed":"Pending")):alert("Selected: ".concat(e.title))},[n]);return"tutor"===v&&p?h?(0,o.jsx)("div",{className:x().container,children:(0,o.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:"Loading bookings..."})}):b?(0,o.jsx)("div",{className:x().container,children:(0,o.jsxs)("div",{style:{textAlign:"center",padding:"20px",color:"red"},children:["Error: ",b,(0,o.jsx)("button",{onClick:w,style:{marginLeft:"10px"},children:"Retry"})]})}):(0,o.jsxs)("div",{className:x().container,children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,o.jsx)("h2",{className:x().title,children:"My Lessons Calendar"}),(0,o.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,o.jsxs)("span",{style:{fontSize:"14px",color:"#666"},children:[(null==T||null==(t=T.subjects)?void 0:t.length)||0," Subjects |"," ",c.filter(e=>{var t;return null==(t=e.booking)?void 0:t.confirmed}).length," Confirmed Lessons"]}),(0,o.jsx)("button",{onClick:w,style:{padding:"8px 16px",cursor:"pointer",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"6px",transition:"background-color 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#7c3aed",onMouseOut:e=>e.currentTarget.style.backgroundColor="#8b5cf6",children:"Refresh"})]})]}),(0,o.jsxs)("div",{className:x().instructions,children:[(0,o.jsx)("h4",{className:x().instructionsTitle,children:"Calendar Guide:"}),(0,o.jsxs)("ul",{className:x().instructionsList,children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{style:{color:"#8b5cf6",fontWeight:"bold"},children:"Purple"})," - Confirmed lessons"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{style:{color:"#f59e0b",fontWeight:"bold"},children:"Orange"})," - Pending confirmation"]}),(0,o.jsx)("li",{children:"Click on empty slots to create new lessons"}),(0,o.jsx)("li",{children:"Click on lessons to view details or join meetings"})]})]}),(0,o.jsx)("div",{className:x().calendarWrapper,style:{height:"600px"},children:(0,o.jsx)(_.Vv,{localizer:N,events:c,startAccessor:"start",endAccessor:"end",views:["week","day","month"],defaultView:"week",min:new Date(2025,0,1,7,0),max:new Date(2030,11,31,22,0),step:30,timeslots:2,style:{height:"100%"},onSelectEvent:L,onSelectSlot:I,selectable:!0,components:{event:e=>{let{event:t}=e;return(0,o.jsx)("button",{style:(e=>{let t={padding:"2px 8px",borderRadius:"4px",cursor:"pointer",border:"none",fontSize:"12px",fontWeight:"500",transition:"all 0.2s ease",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"};switch(e){case"lesson":return{...t,backgroundColor:"#8b5cf6",color:"white"};case"pending-lesson":return{...t,backgroundColor:"#f59e0b",color:"white"};case"meeting":return{...t,backgroundColor:"#3b82f6",color:"white"};case"review":return{...t,backgroundColor:"#ef4444",color:"white"};case"social":return{...t,backgroundColor:"#10b981",color:"white"};default:return{...t,backgroundColor:"#6b7280",color:"white"}}})(t.type),onClick:e=>{e.stopPropagation(),console.log("Event clicked:",t);let o=t.booking;o&&n?n(o):o?alert("Booking Details:\n    Subject: ".concat(o.subject,"\n    Date: ").concat(g()(t.start).format("MMM D, YYYY h:mm A"),"\n    Status: ").concat(o.confirmed?"Confirmed":"Pending","\n    Details: ").concat(o.extraDetails||"No additional details","\n    Student ID: ").concat(o.studentId)):alert("Clicked on: ".concat(t.title))},onMouseOver:e=>{e.currentTarget.style.opacity="0.8"},onMouseOut:e=>{e.currentTarget.style.opacity="1"},children:t.title})}},eventPropGetter:e=>({style:{backgroundColor:"transparent",border:"none",padding:"0"}})})}),(0,o.jsxs)("div",{className:x().currentEvents,children:[(0,o.jsxs)("h4",{className:x().currentEventsTitle,children:["Upcoming Lessons (",c.length,"):"]}),(0,o.jsx)("div",{className:x().eventsList,children:0===c.length?(0,o.jsx)("div",{style:{fontStyle:"italic",color:"#666"},children:"No upcoming lessons scheduled"}):c.filter(e=>new Date(e.start)>=new Date).sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()).slice(0,10).map(e=>{var t,n,s,a,l,r,i;return(0,o.jsxs)("div",{className:x().eventItem,children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:(null==(t=e.booking)?void 0:t.subject)||e.title}),(0,o.jsx)("br",{}),(0,o.jsx)("span",{style:{fontSize:"12px",color:"#666"},children:g()(e.start).format("MMM D, YYYY h:mm A")}),(null==(n=e.booking)?void 0:n.durationMinutes)&&(0,o.jsxs)("span",{style:{fontSize:"12px",color:"#666",marginLeft:"8px"},children:["(",e.booking.durationMinutes," min)"]})]}),(0,o.jsx)("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"600",backgroundColor:(null==(s=e.booking)?void 0:s.confirmed)?"#dcfce7":"#fed7aa",color:(null==(a=e.booking)?void 0:a.confirmed)?"#166534":"#c2410c"},children:(null==(l=e.booking)?void 0:l.confirmed)?"Confirmed":"Pending"})]}),(null==(r=e.booking)?void 0:r.extraDetails)&&(0,o.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px",padding:"4px",backgroundColor:"#f3f4f6",borderRadius:"4px"},children:e.booking.extraDetails}),(null==(i=e.booking)?void 0:i.meetingLink)&&(0,o.jsx)("a",{href:e.booking.meetingLink,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"12px",color:"#3b82f6",textDecoration:"none",marginTop:"4px",display:"inline-block"},children:"Join Meeting →"})]},e.id)})})]}),a&&r&&(0,o.jsx)(y,{selectedDate:r,onClose:A,onSubmit:H})]}):(0,o.jsx)("div",{className:x().container,children:(0,o.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:"Not authorized. Please log in as a tutor."})})};var T=n(672),S=n(5217),C=n.n(S);let M=e=>{let{isOpen:t,onClose:n,subject:s="",time:a="",parentFullName:l="",parentContactNumber:r="",parentEmail:i="",meetingLink:c="",onJoinLesson:d=()=>{}}=e;return t?(0,o.jsx)("div",{className:C().modalOverlay,children:(0,o.jsxs)("div",{className:C().modalContainer,children:[(0,o.jsxs)("div",{className:C().header,children:[(0,o.jsx)("h2",{className:C().headerTitle,children:"Booking Details"}),(0,o.jsx)("button",{onClick:n,className:C().closeButton,children:(0,o.jsx)(T.A,{size:20})})]}),(0,o.jsxs)("div",{className:C().body,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:C().label,children:"Subject:"}),(0,o.jsx)("div",{className:C().infoBox,children:s})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:C().label,children:"Time:"}),(0,o.jsx)("div",{className:C().infoBox,children:a})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:C().label,children:"Parent Full Name:"}),(0,o.jsx)("div",{className:C().infoBox,children:l})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:C().label,children:"Parent Contact Number:"}),(0,o.jsx)("div",{className:C().infoBox,children:r})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:C().label,children:"Parent Email:"}),(0,o.jsx)("div",{className:C().infoBox,children:i})]}),(0,o.jsxs)("div",{className:C().meetingSection,children:[(0,o.jsx)("div",{className:C().meetingLabel,children:"Link to join meeting"}),(0,o.jsx)("div",{className:C().meetingLabel,children:"or"}),(0,o.jsx)("button",{onClick:d,className:C().joinButton,children:"Join Lesson"})]})]})]})}):null};var w=n(2671),I=n(6739),A=n(9083),H=n(9142),L=n(498),D=n(2089),B=n(8603),E=n.n(B);let G=e=>{let{isOpen:t,onClose:n,booking:i,studentName:c="Student",tutorId:d,onConfirm:u,onDelete:m,isLoading:_=!1}=e,[h,f]=(0,s.useState)(null),[x,b]=(0,s.useState)(!1),[j,p]=(0,s.useState)(!1);if(!t||!i)return null;let v=async e=>{try{let{date:t}=e,n=new Date(t.year,t.month-1,t.day,t.hour,t.minute),o=60*(e.durationMinutes||60)*1e3,s=new Date(n.getTime()+o),a=await fetch("/api/bookings/confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:e.bookingId,tutorId:d,subject:e.subject||"Tuition Session",startTime:n.toISOString(),endTime:s.toISOString()})});if(!a.ok){let e=await a.json();throw Error(e.message||"HTTP error! status: ".concat(a.status))}return await a.json()}catch(e){throw console.error("Error creating Teams meeting:",e),e}},y=async()=>{if(i){b(!0),f(null);try{let e=await v(i);f(e),setTimeout(()=>{u(i.bookingId),n()},2e3)}catch(e){f({success:!1,error:e.message||"Failed to create Teams meeting. Please try again."})}finally{b(!1)}}},N=async()=>{if(i&&window.confirm("Are you sure you want to delete this booking?")){p(!0);try{await m(i.bookingId),n()}catch(e){console.error("Error deleting booking:",e)}finally{p(!1)}}};return(0,o.jsx)("div",{className:E().modalOverlay,children:(0,o.jsxs)("div",{className:E().modalContent,children:[(0,o.jsxs)("div",{className:E().modalHeader,children:[(0,o.jsx)("h2",{className:E().modalTitle,children:i.confirmed?"Booking Details":"Confirm Booking"}),(0,o.jsx)("button",{onClick:n,className:E().closeButton,disabled:x||j,children:(0,o.jsx)(T.A,{size:24})})]}),(0,o.jsxs)("div",{className:E().modalBody,children:[(0,o.jsxs)("div",{className:E().bookingDetails,children:[(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(w.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Student"}),(0,o.jsx)("span",{className:E().detailValue,children:c})]})]}),(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(r.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Subject"}),(0,o.jsx)("span",{className:E().detailValue,children:i.subject})]})]}),(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(l.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Date & Time"}),(0,o.jsx)("span",{className:E().detailValue,children:(e=>{let{date:t}=e,n=new Date(t.year,t.month-1,t.day,t.hour,t.minute);return g()(n).format("MMMM D, YYYY [at] h:mm A")})(i)})]})]}),(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(a.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Duration"}),(0,o.jsx)("span",{className:E().detailValue,children:(e=>{if(!e)return"60 minutes";let t=Math.floor(e/60),n=e%60;return t>0&&n>0?"".concat(t," hour").concat(t>1?"s":""," ").concat(n," minute").concat(n>1?"s":""):t>0?"".concat(t," hour").concat(t>1?"s":""):"".concat(n," minute").concat(n>1?"s":"")})(i.durationMinutes)})]})]}),i.extraDetails&&(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(I.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Additional Notes"}),(0,o.jsx)("span",{className:E().detailValue,children:i.extraDetails})]})]}),i.meetingLink&&(0,o.jsxs)("div",{className:E().detailRow,children:[(0,o.jsx)("div",{className:E().detailIcon,children:(0,o.jsx)(A.A,{size:20})}),(0,o.jsxs)("div",{className:E().detailContent,children:[(0,o.jsx)("span",{className:E().detailLabel,children:"Teams Meeting"}),(0,o.jsxs)("a",{href:i.meetingLink,target:"_blank",rel:"noopener noreferrer",className:E().meetingLink,children:["Join Meeting ",(0,o.jsx)(H.A,{size:16})]})]})]})]}),h&&(0,o.jsxs)("div",{className:"".concat(E().statusMessage," ").concat(h.success?E().success:E().error),children:[(0,o.jsx)("div",{className:E().statusIcon,children:h.success?(0,o.jsx)(L.A,{size:20}):(0,o.jsx)(I.A,{size:20})}),(0,o.jsx)("div",{className:E().statusText,children:h.success?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("strong",{children:"Teams meeting created successfully!"}),h.teamsJoinUrl&&(0,o.jsx)("a",{href:h.teamsJoinUrl,target:"_blank",rel:"noopener noreferrer",className:E().statusLink,children:"Open Teams Meeting"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("strong",{children:"Failed to create Teams meeting"}),(0,o.jsx)("span",{children:h.error})]})})]})]}),(0,o.jsx)("div",{className:E().modalFooter,children:i.confirmed?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:n,className:"".concat(E().button," ").concat(E().cancelButton),children:"Close"}),i.meetingLink&&(0,o.jsxs)("a",{href:i.meetingLink,target:"_blank",rel:"noopener noreferrer",className:"".concat(E().button," ").concat(E().confirmButton),children:[(0,o.jsx)(A.A,{size:18}),"Join Teams Meeting"]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:N,className:"".concat(E().button," ").concat(E().deleteButton),disabled:x||j,children:j?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:E().spinner}),"Deleting..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(D.A,{size:18}),"Delete Booking"]})}),(0,o.jsx)("button",{onClick:y,className:"".concat(E().button," ").concat(E().confirmButton),disabled:x||j,children:x?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:E().spinner}),"Creating Teams Meeting..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(L.A,{size:18}),"Confirm & Create Teams Meeting"]})})]})})]})})};var P=n(5104),z=n(387),F=n.n(z);let q=e=>{var t,n,a;let{isOpen:l,onClose:i,onStudentAdded:c}=e,[d,m]=(0,s.useState)([]),[_,h]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[x,b]=(0,s.useState)(!1),[j,y]=(0,s.useState)(""),{tutorProfile:N,userProfile:k}=(0,u.ur)(),S=(null==k?void 0:k.uid)||"",C=(null==N?void 0:N.subjects)||[];(0,s.useEffect)(()=>{l&&C.length>0&&M()},[l,C]);let M=async()=>{b(!0),y("");try{console.log("Fetching students for tutor subjects:",C);let[e,t]=await Promise.all([(0,p.GG)((0,p.rJ)(v.db,"students")),(0,p.GG)((0,p.rJ)(v.db,"users"))]);console.log("Total students found:",e.size),console.log("Total users found:",t.size);let n=new Map;t.forEach(e=>{let t={...e.data(),uid:e.id};n.set(e.id,t)});let o=[];e.forEach(e=>{let t={...e.data(),uid:e.id},s=n.get(t.uid);if(console.log("Processing student with uid:",t.uid),console.log("Found user profile:",s),console.log("Student subjects:",t.subjects),!s)return void console.log("No user profile found for student:",t.uid);let a=Array.isArray(t.subjects)?t.subjects:[],l=C.filter(e=>(console.log("Checking tutor subject:",e),a.some(t=>{let n=t.subjectName.toLowerCase().trim()===e.toLowerCase().trim(),o=!t.tutorId||""===t.tutorId;return n&&o})));console.log("Matching subjects for student:",l),l.length>0&&o.push({studentId:t.uid,studentProfile:t,userProfile:s,availableSubjects:l})}),console.log("Eligible students found:",o.length),m(o)}catch(e){console.error("Error fetching available students:",e),y("Failed to load available students")}finally{b(!1)}},I=e=>{h(e),f("")},A=async()=>{if(!_||!g)return void y("Please select both a student and subject");b(!0),y("");try{let e=d.find(e=>e.studentId===_);if(!e)throw Error("Student not found");let t=e.studentProfile.subjects.map(e=>e.subjectName.toLowerCase().trim()===g.toLowerCase().trim()?{...e,tutorId:S}:e),n=(0,p.H9)(v.db,"students",_);await (0,p.mZ)(n,{subjects:t});let o=(0,p.H9)(v.db,"tutors",S);(await (0,p.x7)(o)).exists()?await (0,p.mZ)(o,{studentIds:(0,p.hq)(_)}):console.warn("Tutor document not found, cannot update studentIds"),c&&c(),h(""),f(""),i()}catch(e){console.error("Error adding student:",e),y("Failed to add student. Please try again.")}finally{b(!1)}},H=()=>{h(""),f(""),y(""),i()};return l?(0,o.jsx)("div",{className:F().overlay,children:(0,o.jsxs)("div",{className:F().modal,children:[(0,o.jsxs)("div",{className:F().header,children:[(0,o.jsxs)("div",{className:F().headerContent,children:[(0,o.jsx)("div",{className:F().headerIcon,children:(0,o.jsx)(P.A,{className:F().iconSize})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{className:F().title,children:"Add Student"}),(0,o.jsx)("p",{className:F().subtitle,children:"Assign a student to your tutoring subjects"})]})]}),(0,o.jsx)("button",{onClick:H,className:F().closeButton,children:(0,o.jsx)(T.A,{className:F().iconSize})})]}),(0,o.jsxs)("div",{className:F().content,children:[j&&(0,o.jsx)("div",{className:F().errorMessage,children:j}),(0,o.jsxs)("div",{className:F().formGroup,children:[(0,o.jsxs)("label",{className:F().label,children:[(0,o.jsx)(w.A,{className:F().labelIcon}),"Select Student"]}),(0,o.jsxs)("select",{value:_,onChange:e=>I(e.target.value),className:F().select,disabled:x,children:[(0,o.jsx)("option",{value:"",children:"Choose a student..."}),d.map(e=>(0,o.jsxs)("option",{value:e.studentId,children:[e.userProfile.displayName||"Student ".concat(e.studentId),e.studentProfile.grade&&" - Grade ".concat(e.studentProfile.grade),e.userProfile.email&&" (".concat(e.userProfile.email,")")]},e.studentId))]}),0===d.length&&!x&&(0,o.jsx)("p",{className:F().noStudents,children:"No available students found for your subjects"})]}),_&&(0,o.jsxs)("div",{className:F().formGroup,children:[(0,o.jsxs)("label",{className:F().label,children:[(0,o.jsx)(r.A,{className:F().labelIcon}),"Select Subject"]}),(0,o.jsxs)("select",{value:g,onChange:e=>f(e.target.value),className:F().select,disabled:x,children:[(0,o.jsx)("option",{value:"",children:"Choose a subject..."}),(()=>{if(!_)return[];let e=d.find(e=>e.studentId===_);return(null==e?void 0:e.availableSubjects)||[]})().map(e=>(0,o.jsx)("option",{value:e,children:e},e))]})]}),_&&g&&(0,o.jsxs)("div",{className:F().selectedInfo,children:[(0,o.jsx)("h4",{className:F().selectedTitle,children:"Assignment Summary:"}),(0,o.jsxs)("div",{className:F().selectedDetails,children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Student:"})," ",(null==(t=d.find(e=>e.studentId===_))?void 0:t.userProfile.displayName)||"Unknown Student"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Email:"})," ",(null==(n=d.find(e=>e.studentId===_))?void 0:n.userProfile.email)||"No email"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Grade:"})," ",(null==(a=d.find(e=>e.studentId===_))?void 0:a.studentProfile.grade)||"Not specified"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Subject:"})," ",g]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Tutor:"})," ",(null==N?void 0:N.uid)?"You":"Unknown"]})]})]})]}),(0,o.jsxs)("div",{className:F().footer,children:[(0,o.jsx)("button",{onClick:H,className:F().cancelButton,disabled:x,children:"Cancel"}),(0,o.jsx)("button",{onClick:A,className:F().addButton,disabled:x||!_||!g,children:x?"Adding...":"Add Student"})]})]})}):null};var O=n(3044),J=n.n(O);let R=e=>{let{icon:t,title:n,value:s,subtitle:a,color:l="blue"}=e;return(0,o.jsx)("div",{className:"".concat(J().statCard," ").concat(J()["statCard".concat(l.charAt(0).toUpperCase()+l.slice(1))]),children:(0,o.jsxs)("div",{className:J().statContent,children:[(0,o.jsx)("div",{className:J().statIcon,children:(0,o.jsx)(t,{className:J().iconSize})}),(0,o.jsxs)("div",{className:J().statDetails,children:[(0,o.jsx)("h3",{className:J().statValue,children:s}),(0,o.jsx)("p",{className:J().statTitle,children:n}),a&&(0,o.jsx)("p",{className:J().statSubtitle,children:a})]})]})})},W=e=>{let{icon:t,title:n,content:s,action:a,onActionClick:l,color:r="blue"}=e;return(0,o.jsxs)("div",{className:J().infoCard,children:[(0,o.jsxs)("div",{className:J().infoHeader,children:[(0,o.jsx)("div",{className:"".concat(J().infoIcon," ").concat(J()["infoIcon".concat(r.charAt(0).toUpperCase()+r.slice(1))]),children:(0,o.jsx)(t,{className:J().iconSize})}),(0,o.jsx)("h3",{className:J().infoTitle,children:n})]}),(0,o.jsxs)("div",{className:J().infoContent,children:[(0,o.jsx)("p",{className:J().infoText,children:s}),a&&(0,o.jsx)("button",{className:J().infoAction,onClick:l,children:a})]})]})},Y=e=>{let t,{navigation:n}=e,[_,h]=(0,s.useState)(null),[g,f]=(0,s.useState)(!1),[x,b]=(0,s.useState)(!1),[j,p]=(0,s.useState)(!1),[v,y]=(0,s.useState)(!1),[N,T]=(0,s.useState)(0),[S,C]=(0,s.useState)({weeklyEarnings:0,weeklyHours:0,weeklyLessons:0}),[w,I]=(0,s.useState)(0),[A,H]=(0,s.useState)(!0),{user:L,userType:D,userProfile:B,tutorProfile:E}=(0,u.ur)(),{fetchWeeklyStatistics:P,calculateTotalStudents:z}=(0,m.q)(),F=(null==E?void 0:E.uid)||"";(0,s.useEffect)(()=>{(async()=>{H(!0);try{let[e,t]=await Promise.all([P(),z()]);C(e),I(t)}catch(e){console.error("Error loading statistics:",e)}finally{H(!1)}})()},[P,z]);let O=async e=>{y(!0);try{b(!1),h(null),T(e=>e+1);let[e,t]=await Promise.all([P(),z()]);C(e),I(t)}catch(e){console.error("Error confirming booking:",e)}finally{y(!1)}},Y=async e=>{y(!0);try{b(!1),h(null),T(e=>e+1);let[e,t]=await Promise.all([P(),z()]);C(e),I(t)}catch(e){console.error("Error deleting booking:",e)}finally{y(!1)}},V=async()=>{console.log("Student added successfully");let[e,t]=await Promise.all([P(),z()]);C(e),I(t)};return(0,o.jsxs)("div",{className:J().container,children:[(0,o.jsx)("div",{className:J().header,children:(0,o.jsx)("div",{className:J().headerContent,children:(0,o.jsxs)("div",{className:J().headerInfo,children:[(0,o.jsx)("h1",{className:J().pageTitle,children:"Dashboard"}),(0,o.jsx)("p",{className:J().pageSubtitle,children:"Welcome back! Here's what's happening today."})]})})}),(0,o.jsxs)("div",{className:J().mainContent,children:[(0,o.jsxs)("div",{className:J().statsSection,children:[(0,o.jsx)("h2",{className:J().sectionTitle,children:"This Week's Overview"}),(0,o.jsxs)("div",{className:J().statsGrid,children:[(0,o.jsx)(R,{icon:a.A,title:"Weekly Earnings",value:A?"Loading...":(t=S.weeklyEarnings,new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)),subtitle:"This week's earnings",color:"green"}),(0,o.jsx)(R,{icon:l.A,title:"Weekly Hours",value:A?"...":(e=>{if(0===e)return"0h";if(e<1)return"".concat(Math.round(60*e),"min");let t=Math.floor(e),n=Math.round((e-t)*60);return 0===n?"".concat(t,"h"):"".concat(t,"h ").concat(n,"min")})(S.weeklyHours),subtitle:"Teaching this week",color:"purple"}),(0,o.jsx)(R,{icon:r.A,title:"Weekly Lessons",value:A?"...":S.weeklyLessons,subtitle:"Scheduled this week",color:"blue"}),(0,o.jsx)(R,{icon:i.A,title:"Total Students",value:A?"...":w,subtitle:"All time",color:"orange"})]})]}),(0,o.jsxs)("div",{className:J().infoSection,children:[(0,o.jsx)("h2",{className:J().sectionTitle,children:"Quick Actions"}),(0,o.jsxs)("div",{className:J().infoGrid,children:[(0,o.jsx)(W,{icon:a.A,title:"Upcoming Lessons",content:"View and manage your upcoming lessons.",action:"Schedule New",onActionClick:()=>{console.log("Opening schedule lesson dialog")},color:"blue"}),(0,o.jsx)(W,{icon:c.A,title:"Messages",content:"Communicate with your students.",action:"Send Message",onActionClick:()=>{console.log("Opening message dialog")},color:"green"}),(0,o.jsx)(W,{icon:d.A,title:"Add Student",content:"Add a student to your roster to start scheduling lessons.",action:"Add Student",onActionClick:()=>{p(!0)},color:"orange"})]})]}),(0,o.jsxs)("div",{className:J().calendarSection,children:[(0,o.jsxs)("div",{className:J().calendarHeader,children:[(0,o.jsx)("h2",{className:J().sectionTitle,children:"Your Schedule"}),(0,o.jsx)("p",{className:J().calendarSubtitle,children:"Click on any lesson to view details or make changes"})]}),(0,o.jsx)("div",{className:J().calendarContainer,children:(0,o.jsx)(k,{onLessonClick:e=>{h(e),e.confirmed?f(!0):b(!0)}},N)})]}),_&&(0,o.jsx)(M,{isOpen:g,onClose:()=>{f(!1),h(null)},...(e=>({bookingId:e.bookingId,subject:e.subject,date:e.date,studentId:e.studentId,tutorId:e.tutorId,meetingLink:e.meetingLink,confirmed:e.confirmed,extraDetails:e.extraDetails,durationMinutes:e.durationMinutes}))(_),onJoinLesson:()=>{(null==_?void 0:_.meetingLink)?(console.log("Joining lesson:",_.bookingId),window.open(_.meetingLink,"_blank")):(null==_?void 0:_.teamsJoinUrl)?(console.log("Joining Teams lesson:",_.bookingId),window.open(_.teamsJoinUrl,"_blank")):(console.log("No meeting link available for this lesson"),alert("No meeting link available for this lesson. Please create a Teams meeting first."))}}),(0,o.jsx)(G,{isOpen:x,onClose:()=>{b(!1),h(null)},tutorId:F,booking:_,studentName:"Student Name",onConfirm:O,onDelete:Y,isLoading:v}),(0,o.jsx)(q,{isOpen:j,onClose:()=>{p(!1)},onStudentAdded:V})]})]})},V=Y}}]);